// Carregar dados iniciais
            await carregarMenu();
            await carregarHistoricoPedidos();
            
            if (usuarioLogado.tipo === 'admin') {
                await carregarDashboard();
            }
        }

        // Fun√ß√µes de navega√ß√£o
        async function showMainTab(tabName) {
            // Verificar permiss√µes
            const tabsAdmin = ['dashboard', 'usuarios', 'cardapio', 'relatorios', 'configuracoes'];
            if (tabsAdmin.includes(tabName) && !verificarPermissao('admin')) {
                const elemento = document.getElementById(tabName);
                mostrarPermissaoNegada(elemento);
                return;
            }
            
            // Esconder todas as abas
            document.querySelectorAll('#main-system .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active dos bot√µes
            document.querySelectorAll('#main-system .nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Carregar dados espec√≠ficos da aba
            switch(tabName) {
                case 'dashboard':
                    await carregarDashboard();
                    break;
                case 'usuarios':
                    await carregarUsuarios();
                    break;
                case 'cardapio':
                    await carregarCardapioAdmin();
                    break;
                case 'relatorios':
                    await carregarRelatorios();
                    break;
                case 'configuracoes':
                    await carregarConfiguracoes();
                    break;
            }
        }

        // Fun√ß√µes do sistema de pedidos
        async function carregarMenu() {
            try {
                const cardapio = await db.select('cardapio');
                const menuGrid = document.getElementById('menuGrid');
                
                menuGrid.innerHTML = '';
                
                cardapio.forEach(prato => {
                    if (prato.status === 'ativo') {
                        const menuDay = document.createElement('div');
                        menuDay.className = 'menu-day';
                        menuDay.innerHTML = `
                            <h4>${prato.dia}</h4>
                            <p>${prato.descricao}</p>
                            <p class="menu-price">R$ ${prato.preco.toFixed(2)}</p>
                        `;
                        menuGrid.appendChild(menuDay);
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar menu:', error);
                showAlert('Erro ao carregar card√°pio', 'error');
            }
        }

        async function fazerPedido(event) {
            event.preventDefault();
            
            const diasSelecionados = [];
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                diasSelecionados.push(checkbox.value);
            });
            
            if (diasSelecionados.length === 0) {
                showAlert('Selecione pelo menos um dia da semana!', 'error');
                return;
            }
            
            try {
                // Calcular valor total baseado no card√°pio
                const cardapio = await db.select('cardapio');
                let valorTotal = 0;
                
                diasSelecionados.forEach(dia => {
                    const prato = cardapio.find(p => p.dia === dia && p.status === 'ativo');
                    if (prato) {
                        valorTotal += prato.preco;
                    }
                });
                
                const novoPedido = {
                    usuarioId: usuarioLogado.id,
                    usuario: usuarioLogado.nome,
                    email: usuarioLogado.email,
                    setor: usuarioLogado.setor,
                    diasSelecionados: diasSelecionados,
                    valorTotal: valorTotal,
                    data: new Date().toISOString(),
                    status: 'confirmado'
                };
                
                await db.insert('pedidos', novoPedido);
                showAlert(`üçΩÔ∏è Pedido confirmado! Total: R$ ${valorTotal.toFixed(2)} para: ${diasSelecionados.join(', ')}`);
                
                // Limpar checkboxes
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                await carregarHistoricoPedidos();
                
                if (usuarioLogado.tipo === 'admin') {
                    await carregarDashboard();
                }
            } catch (error) {
                console.error('Erro ao fazer pedido:', error);
                showAlert('Erro ao confirmar pedido', 'error');
            }
        }

        async function carregarHistoricoPedidos() {
            try {
                showLoading('loadingPedidos', true);
                const pedidos = await db.select('pedidos');
                const pedidosUsuario = pedidos.filter(p => p.usuarioId === usuarioLogado.id);
                const tbody = document.getElementById('historicoPedidos');
                
                tbody.innerHTML = '';
                showLoading('loadingPedidos', false);
                
                if (pedidosUsuario.length === 0) {
                    const row = tbody.insertRow();
                    row.innerHTML = '<td colspan="5" style="text-align: center; color: #666;">Nenhum pedido encontrado</td>';
                    return;
                }
                
                pedidosUsuario.forEach(pedido => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${new Date(pedido.data).toLocaleDateString('pt-BR')}</td>
                        <td>${pedido.diasSelecionados.join(', ')}</td>
                        <td><span class="status-badge status-ativo">${pedido.status}</span></td>
                        <td style="color: #ff6b1a; font-weight: bold;">R$ ${(pedido.valorTotal || 0).toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="cancelarPedido(${pedido.id})">Cancelar</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
                showLoading('loadingPedidos', false);
                showAlert('Erro ao carregar hist√≥rico de pedidos', 'error');
            }
        }

        async function cancelarPedido(pedidoId) {
            if (confirm('Tem certeza que deseja cancelar este pedido?')) {
                try {
                    await db.delete('pedidos', pedidoId);
                    await carregarHistoricoPedidos();
                    showAlert('Pedido cancelado com sucesso!');
                    
                    if (usuarioLogado.tipo === 'admin') {
                        await carregarDashboard();
                    }
                } catch (error) {
                    console.error('Erro ao cancelar pedido:', error);
                    showAlert('Erro ao cancelar pedido', 'error');
                }
            }
        }

        // Fun√ß√µes administrativas
        async function carregarDashboard() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showLoading('loadingDashboard', true);
                
                const usuarios = await db.select('usuarios');
                const pedidos = await db.select('pedidos');
                
                // Estat√≠sticas gerais
                document.getElementById('totalUsuarios').textContent = usuarios.filter(u => u.status === 'ativo').length;
                
                const hoje = new Date().toDateString();
                const pedidosHoje = pedidos.filter(p => new Date(p.data).toDateString() === hoje);
                document.getElementById('totalPedidos').textContent = pedidosHoje.length;
                
                // Total de marmitas da semana
                const inicioSemana = new Date();
                inicioSemana.setDate(inicioSemana.getDate() - inicioSemana.getDay());
                const pedidosSemana = pedidos.filter(p => new Date(p.data) >= inicioSemana);
                const totalMarmitas = pedidosSemana.reduce((total, pedido) => total + pedido.diasSelecionados.length, 0);
                document.getElementById('totalMarmitas').textContent = totalMarmitas;
                
                // Receita semanal
                const receitaSemana = pedidosSemana.reduce((total, pedido) => total + (pedido.valorTotal || 0), 0);
                document.getElementById('receitaSemana').textContent = `R$ ${receitaSemana.toFixed(2)}`;
                
                // Estat√≠sticas por setor
                await carregarEstatisticasSetor();
                showLoading('loadingDashboard', false);
                
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                showLoading('loadingDashboard', false);
                showAlert('Erro ao carregar dashboard', 'error');
            }
        }

        async function carregarEstatisticasSetor() {
            try {
                const usuarios = await db.select('usuarios');
                const pedidos = await db.select('pedidos');
                const tbody = document.getElementById('estatisticasSetor');
                
                tbody.innerHTML = '';
                
                const setores = [...new Set(usuarios.map(u => u.setor))];
                const hoje = new Date().toDateString();
                const inicioSemana = new Date();
                inicioSemana.setDate(inicioSemana.getDate() - inicioSemana.getDay());
                
                setores.forEach(setor => {
                    const usuariosSetor = usuarios.filter(u => u.setor === setor && u.status === 'ativo');
                    const pedidosSetorHoje = pedidos.filter(p => p.setor === setor && new Date(p.data).toDateString() === hoje);
                    const pedidosSetorSemana = pedidos.filter(p => p.setor === setor && new Date(p.data) >= inicioSemana);
                    const totalSemana = pedidosSetorSemana.reduce((total, pedido) => total + pedido.diasSelecionados.length, 0);
                    const receitaSetor = pedidosSetorSemana.reduce((total, pedido) => total + (pedido.valorTotal || 0), 0);
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${setor}</td>
                        <td>${pedidosSetorHoje.length}</td>
                        <td>${totalSemana}</td>
                        <td>${usuariosSetor.length}</td>
                        <td style="color: #ff6b1a; font-weight: bold;">R$ ${receitaSetor.toFixed(2)}</td>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas por setor:', error);
            }
        }

        async function carregarUsuarios() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showLoading('loadingUsuarios', true);
                const usuarios = await db.select('usuarios');
                const tbody = document.getElementById('listaUsuarios');
                
                tbody.innerHTML = '';
                showLoading('loadingUsuarios', false);
                
                usuarios.forEach(usuario => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${usuario.nome}</td>
                        <td>${usuario.email}</td>
                        <td>${usuario.setor}</td>
                        <td><span class="status-badge ${usuario.tipo === 'admin' ? 'status-admin' : 'status-ativo'}">${usuario.tipo === 'admin' ? 'Admin' : 'Usu√°rio'}</span></td>
                        <td><span class="status-badge ${usuario.status === 'ativo' ? 'status-ativo' : 'status-inativo'}">${usuario.status}</span></td>
                        <td>${new Date(usuario.dataCadastro).toLocaleDateString('pt-BR')}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarUsuario(${usuario.id})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="removerUsuario(${usuario.id})">üóëÔ∏è Remover</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                showLoading('loadingUsuarios', false);
                showAlert('Erro ao carregar usu√°rios', 'error');
            }
        }

        async function carregarCardapioAdmin() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showLoading('loadingCardapio', true);
                const cardapio = await db.select('cardapio');
                const container = document.getElementById('cardapioAdmin');
                
                container.innerHTML = '';
                showLoading('loadingCardapio', false);
                
                cardapio.forEach(prato => {
                    const pratoDiv = document.createElement('div');
                    pratoDiv.className = 'menu-day';
                    pratoDiv.innerHTML = `
                        <h4>${prato.dia}</h4>
                        <p>${prato.descricao}</p>
                        <p class="menu-price">R$ ${prato.preco.toFixed(2)}</p>
                        <p><span class="status-badge ${prato.status === 'ativo' ? 'status-ativo' : 'status-inativo'}">${prato.status}</span></p>
                        <div class="menu-actions">
                            <button class="btn btn-sm btn-warning" onclick="editarPrato(${prato.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="removerPrato(${prato.id})">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(pratoDiv);
                });
            } catch (error) {
                console.error('Erro ao carregar card√°pio admin:', error);
                showLoading('loadingCardapio', false);
                showAlert('Erro ao carregar card√°pio', 'error');
            }
        }

        // Fun√ß√µes de modal
        function abrirModalUsuario(usuarioId = null) {
            if (!verificarPermissao('admin')) return;
            
            const modal = document.getElementById('modalUsuario');
            modal.style.display = 'block';
            
            if (usuarioId) {
                carregarDadosUsuario(usuarioId);
            } else {
                // Limpar formul√°rio para novo usu√°rio
                document.getElementById('usuarioId').value = '';
                document.getElementById('usuarioNome').value = '';
                document.getElementById('usuarioEmail').value = '';
                document.getElementById('usuarioSetor').value = '';
                document.getElementById('usuarioTipo').value = 'usuario';
                document.getElementById('usuarioStatus').value = 'ativo';
                document.getElementById('usuarioSenha').value = '';
            }
        }

        async function carregarDadosUsuario(usuarioId) {
            try {
                const usuario = await db.select('usuarios', usuarioId);
                if (usuario) {
                    document.getElementById('usuarioId').value = usuario.id;
                    document.getElementById('usuarioNome').value = usuario.nome;
                    document.getElementById('usuarioEmail').value = usuario.email;
                    document.getElementById('usuarioSetor').value = usuario.setor;
                    document.getElementById('usuarioTipo').value = usuario.tipo;
                    document.getElementById('usuarioStatus').value = usuario.status;
                    document.getElementById('usuarioSenha').value = '';
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
                showAlert('Erro ao carregar dados do usu√°rio', 'error');
            }
        }

        function abrirModalCardapio(pratoId = null) {
            if (!verificarPermissao('admin')) return;
            
            const modal = document.getElementById('modalCardapio');
            modal.style.display = 'block';
            
            if (pratoId) {
                carregarDadosPrato(pratoId);
            } else {
                // Limpar formul√°rio para novo prato
                document.getElementById('cardapioId').value = '';
                document.getElementById('cardapioDia').value = '';
                document.getElementById('cardapioDescricao').value = '';
                document.getElementById('cardapioPreco').value = '22.00';
                document.getElementById('cardapioStatus').value = 'ativo';
            }
        }

        async function carregarDadosPrato(pratoId) {
            try {
                const prato = await db.select('cardapio', pratoId);
                if (prato) {
                    document.getElementById('cardapioId').value = prato.id;
                    document.getElementById('cardapioDia').value = prato.dia;
                    document.getElementById('cardapioDescricao').value = prato.descricao;
                    document.getElementById('cardapioPreco').value = prato.preco;
                    document.getElementById('cardapioStatus').value = prato.status;
                }
            } catch (error) {
                console.error('Erro ao carregar dados do prato:', error);
                showAlert('Erro ao carregar dados do prato', 'error');
            }
        }

        function abrirModalLogo() {
            if (!verificarPermissao('admin')) {
                showAlert('Apenas administradores podem alterar o logo', 'error');
                return;
            }
            
            const modal = document.getElementById('modalLogo');
            modal.style.display = 'block';
            
            // Carregar preview atual
            const logoAtualElement = document.getElementById('logoImage');
            const logoPreview = document.getElementById('logoPreview');
            const logoPreviewPlaceholder = document.getElementById('logoPreviewPlaceholder');
            
            if (logoAtualElement.style.display !== 'none') {
                logoPreview.src = logoAtualElement.src;
                logoPreview.style.display = 'block';
                logoPreviewPlaceholder.style.display = 'none';
            } else {
                logoPreview.style.display = 'none';
                logoPreviewPlaceholder.style.display = 'block';
            }
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function salvarUsuario(event) {
            event.preventDefault();
            
            try {
                const id = document.getElementById('usuarioId').value;
                const dadosUsuario = {
                    nome: document.getElementById('usuarioNome').value,
                    email: document.getElementById('usuarioEmail').value,
                    setor: document.getElementById('usuarioSetor').value,
                    tipo: document.getElementById('usuarioTipo').value,
                    status: document.getElementById('usuarioStatus').value
                };
                
                const senha = document.getElementById('usuarioSenha').value;
                if (senha) {
                    dadosUsuario.senha = senha;
                }
                
                if (id) {
                    // Atualizar usu√°rio existente
                    dadosUsuario.id = parseInt(id);
                    const usuarioExistente = await db.select('usuarios', dadosUsuario.id);
                    if (!senha) {
                        dadosUsuario.senha = usuarioExistente.senha; // Manter senha atual se n√£o informada
                    }
                    dadosUsuario.dataCadastro = usuarioExistente.dataCadastro;
                    
                    await db.update('usuarios', dadosUsuario);
                    showAlert('‚úÖ Usu√°rio atualizado com sucesso!');
                } else {
                    // Criar novo usu√°rio
                    if (!senha) {
                        showAlert('Senha √© obrigat√≥ria para novos usu√°rios!', 'error');
                        return;
                    }
                    
                    // Verificar se email j√° existe
                    const usuarios = await db.select('usuarios');
                    if (usuarios.find(u => u.email === dadosUsuario.email)) {
                        showAlert('Email j√° cadastrado!', 'error');
                        return;
                    }
                    
                    dadosUsuario.dataCadastro = new Date().toISOString();
                    await db.insert('usuarios', dadosUsuario);
                    showAlert('‚úÖ Usu√°rio criado com sucesso!');
                }
                
                fecharModal('modalUsuario');
                await carregarUsuarios();
                await carregarDashboard();
            } catch (error) {
                console.error('Erro ao salvar usu√°rio:', error);
                showAlert('Erro ao salvar usu√°rio', 'error');
            }
        }

        async function salvarCardapio(event) {
            event.preventDefault();
            
            try {
                const id = document.getElementById('cardapioId').value;
                const dadosPrato = {
                    dia: document.getElementById('cardapioDia').value,
                    descricao: document.getElementById('cardapioDescricao').value,
                    preco: parseFloat(document.getElementById('cardapioPreco').value),
                    status: document.getElementById('cardapioStatus').value
                };
                
                if (id) {
                    dadosPrato.id = parseInt(id);
                    await db.update('cardapio', dadosPrato);
                    showAlert('‚úÖ Prato atualizado com sucesso!');
                } else {
                    await db.insert('cardapio', dadosPrato);
                    showAlert('‚úÖ Prato adicionado com sucesso!');
                }
                
                fecharModal('modalCardapio');
                await carregarCardapioAdmin();
                await carregarMenu(); // Atualizar menu para usu√°rios tamb√©m
            } catch (error) {
                console.error('Erro ao salvar card√°pio:', error);
                showAlert('Erro ao salvar prato', 'error');
            }
        }

        function editarUsuario(id) {
            abrirModalUsuario(id);
        }

        function editarPrato(id) {
            abrirModalCardapio(id);
        }

        async function removerUsuario(id) {
            if (id === usuarioLogado.id) {
                showAlert('Voc√™ n√£o pode remover seu pr√≥prio usu√°rio!', 'error');
                return;
            }
            
            if (confirm('Tem certeza que deseja remover este usu√°rio?')) {
                try {
                    await db.delete('usuarios', id);
                    showAlert('‚úÖ Usu√°rio removido com sucesso!');
                    await carregarUsuarios();
                    await carregarDashboard();
                } catch (error) {
                    console.error('Erro ao remover usu√°rio:', error);
                    showAlert('Erro ao remover usu√°rio', 'error');
                }
            }
        }

        async function removerPrato(id) {
            if (confirm('Tem certeza que deseja remover este prato?')) {
                try {
                    await db.delete('cardapio', id);
                    showAlert('‚úÖ Prato removido com sucesso!');
                    await carregarCardapioAdmin();
                    await carregarMenu();
                } catch (error) {
                    console.error('Erro ao remover prato:', error);
                    showAlert('Erro ao remover prato', 'error');
                }
            }
        }

        // Fun√ß√µes de relat√≥rio
        async function carregarRelatorios() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showLoading('loadingRelatorios', true);
                const pedidos = await db.select('pedidos');
                const usuarios = await db.select('usuarios');
                const tbody = document.getElementById('relatorioTabela');
                
                tbody.innerHTML = '';
                showLoading('loadingRelatorios', false);
                
                if (pedidos.length === 0) {
                    const row = tbody.insertRow();
                    row.innerHTML = '<td colspan="7" style="text-align: center; color: #666;">Nenhum pedido encontrado</td>';
                    return;
                }
                
                pedidos.forEach(pedido => {
                    const usuario = usuarios.find(u => u.id === pedido.usuarioId);
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${new Date(pedido.data).toLocaleDateString('pt-BR')}</td>
                        <td>${pedido.usuario}</td>
                        <td>${usuario ? usuario.email : 'N/A'}</td>
                        <td>${pedido.setor}</td>
                        <td>${pedido.diasSelecionados.join(', ')}</td>
                        <td><span class="status-badge status-ativo">${pedido.status}</span></td>
                        <td style="color: #ff6b1a; font-weight: bold;">R$ ${(pedido.valorTotal || 0).toFixed(2)}</td>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar relat√≥rios:', error);
                showLoading('loadingRelatorios', false);
                showAlert('Erro ao carregar relat√≥rios', 'error');
            }
        }

        async function gerarRelatorio() {
            if (!verificarPermissao('admin')) return;
            
            const dataInicial = document.getElementById('dataInicial').value;
            const dataFinal = document.getElementById('dataFinal').value;
            const filtroSetor = document.getElementById('filtroSetor').value;
            
            if (!dataInicial || !dataFinal) {
                showAlert('Selecione as datas para filtrar!', 'error');
                return;
            }
            
            try {
                showLoading('loadingRelatorios', true);
                
                const inicio = new Date(dataInicial);
                const fim = new Date(dataFinal);
                fim.setHours(23, 59, 59, 999);
                
                const pedidos = await db.select('pedidos');
                const usuarios = await db.select('usuarios');
                
                let pedidosFiltrados = pedidos.filter(pedido => {
                    const dataPedido = new Date(pedido.data);
                    return dataPedido >= inicio && dataPedido <= fim;
                });
                
                if (filtroSetor) {
                    pedidosFiltrados = pedidosFiltrados.filter(p => p.setor === filtroSetor);
                }
                
                const tbody = document.getElementById('relatorioTabela');
                tbody.innerHTML = '';
                showLoading('loadingRelatorios', false);
                
                if (pedidosFiltrados.length === 0) {
                    const row = tbody.insertRow();
                    row.innerHTML = '<td colspan="7" style="text-align: center; color: #666;">Nenhum pedido encontrado no per√≠odo selecionado</td>';
                } else {
                    pedidosFiltrados.forEach(pedido => {
                        const usuario = usuarios.find(u => u.id === pedido.usuarioId);
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${new Date(pedido.data).toLocaleDateString('pt-BR')}</td>
                            <td>${pedido.usuario}</td>
                            <td>${usuario ? usuario.email : 'N/A'}</td>
                            <td>${pedido.setor}</td>
                            <td>${pedido.diasSelecionados.join(', ')}</td>
                            <td><span class="status-badge status-ativo">${pedido.status}</span></td>
                            <td style="color: #ff6b1a; font-weight: bold;">R$ ${(pedido.valorTotal || 0).toFixed(2)}</td>
                        `;
                    });
                }
                
                const valorTotal = pedidosFiltrados.reduce((total, pedido) => total + (pedido.valorTotal || 0), 0);
                showAlert(`üìä ${pedidosFiltrados.length} pedido(s) encontrado(s). Total: R$ ${valorTotal.toFixed(2)}`);
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                showLoading('loadingRelatorios', false);
                showAlert('Erro ao gerar relat√≥rio', 'error');
            }
        }

        async function exportarRelatorio(formato) {
            if (!verificarPermissao('admin')) return;
            
            try {
                const pedidos = await db.select('pedidos');
                const usuarios = await db.select('usuarios');
                
                if (formato === 'excel') {
                    // Exporta√ß√£o CSV
                    let csvContent = "data:text/csv;charset=utf-8,";
                    csvContent += "Data,Usu√°rio,Email,Setor,Dias Pedidos,Status,Valor Total\n";
                    
                    pedidos.forEach(pedido => {
                        const usuario = usuarios.find(u => u.id === pedido.usuarioId);
                        const linha = [
                            new Date(pedido.data).toLocaleDateString('pt-BR'),
                            pedido.usuario,
                            usuario ? usuario.email : 'N/A',
                            pedido.setor,
                            `"${pedido.diasSelecionados.join(', ')}"`,
                            pedido.status,
                            `R$ ${(pedido.valorTotal || 0).toFixed(2)}`
                        ].join(',');
                        csvContent += linha + "\n";
                    });
                    
                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement("a");
                    link.setAttribute("href", encodedUri);
                    link.setAttribute("download", `villa_borghese_relatorio_${new Date().toISOString().split('T')[0]}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showAlert('üìä Relat√≥rio Excel exportado com sucesso!');
                } else if (formato === 'pdf') {
                    showAlert('üìã Funcionalidade de exporta√ß√£o PDF em desenvolvimento!', 'error');
                }
            } catch (error) {
                console.error('Erro ao exportar relat√≥rio:', error);
                showAlert('Erro ao exportar relat√≥rio', 'error');
            }
        }

        // Fun√ß√µes de configura√ß√£o
        async function carregarConfiguracoes() {
            if (!verificarPermissao('admin')) return;
            
            try {
                const configData = await db.select('configuracoes');
                const config = configData.find(c => c.chave === 'empresa');
                
                if (config && config.valor) {
                    document.getElementById('nomeEmpresa').value = config.valor.nomeEmpresa || '';
                    document.getElementById('emailContato').value = config.valor.emailContato || '';
                    document.getElementById('telefoneContato').value = config.valor.telefone || '';
                    document.getElementById('enderecoEmpresa').value = config.valor.endereco || '';
                    document.getElementById('horarioLimite').value = config.valor.horarioLimite || '10:00';
                    document.getElementById('valorMarmita').value = config.valor.valorMarmita || 22.00;
                    
                    // Configurar dias de funcionamento
                    const diasFuncionamento = config.valor.diasFuncionamento || [];
                    document.getElementById('configSegunda').checked = diasFuncionamento.includes('Segunda');
                    document.getElementById('configTerca').checked = diasFuncionamento.includes('Ter√ßa');
                    document.getElementById('configQuarta').checked = diasFuncionamento.includes('Quarta');
                    document.getElementById('configQuinta').checked = diasFuncionamento.includes('Quinta');
                    document.getElementById('configSexta').checked = diasFuncionamento.includes('Sexta');
                    document.getElementById('configSabado').checked = diasFuncionamento.includes('S√°bado');
                    document.getElementById('configDomingo').checked = diasFuncionamento.includes('Domingo');
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
                showAlert('Erro ao carregar configura√ß√µes', 'error');
            }
        }

        async function salvarConfiguracoes() {
            if (!verificarPermissao('admin')) return;
            
            try {
                const diasFuncionamento = [];
                if (document.getElementById('configSegunda').checked) diasFuncionamento.push('Segunda');
                if (document.getElementById('configTerca').checked) diasFuncionamento.push('Ter√ßa');
                if (document.getElementById('configQuarta').checked) diasFuncionamento.push('Quarta');
                if (document.getElementById('configQuinta').checked) diasFuncionamento.push('Quinta');
                if (document.getElementById('configSexta').checked) diasFuncionamento.push('Sexta');
                if (document.getElementById('configSabado').checked) diasFuncionamento.push('S√°bado');
                if (document.getElementById('configDomingo').checked) diasFuncionamento.push('Domingo');
                
                const configuracoes = {
                    chave: 'empresa',
                    valor: {
                        nomeEmpresa: document.getElementById('nomeEmpresa').value,
                        emailContato: document.getElementById('emailContato').value,
                        telefone: document.getElementById('telefoneContato').value,
                        endereco: document.getElementById('enderecoEmpresa').value,
                        horarioLimite: document.getElementById('horarioLimite').value,
                        valorMarmita: parseFloat(document.getElementById('valorMarmita').value),
                        diasFuncionamento: diasFuncionamento
                    }
                };
                
                await db.update('configuracoes', configuracoes);
                showAlert('‚öôÔ∏è Configura√ß√µes salvas com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showAlert('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        // Fun√ß√µes de logo
        async function carregarLogo() {
            try {
                const sistemaData = await db.select('sistema');
                const logoData = sistemaData.find(s => s.chave === 'logo');
                
                if (logoData && logoData.valor) {
                    const logoImage = document.getElementById('logoImage');
                    const logoPlaceholder = document.getElementById('logoPlaceholder');
                    
                    logoImage.src = logoData.valor;
                    logoImage.style.display = 'block';
                    logoPlaceholder.style.display = 'none';
                    logoAtual = logoData.valor;
                }
            } catch (error) {
                console.error('Erro ao carregar logo:', error);
            }
        }

        function previewLogo(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) { // 2MB limite
                    showAlert('Arquivo muito grande! M√°ximo 2MB.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoPreview = document.getElementById('logoPreview');
                    const logoPreviewPlaceholder = document.getElementById('logoPreviewPlaceholder');
                    
                    logoPreview.src = e.target.result;
                    logoPreview.style.display = 'block';
                    logoPreviewPlaceholder.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        async function salvarLogo() {
            try {
                const logoPreview = document.getElementById('logoPreview');
                if (logoPreview.src && logoPreview.style.display !== 'none') {
                    await db.update('sistema', {
                        chave: 'logo',
                        valor: logoPreview.src
                    });
                    
                    // Atualizar logo principal
                    const logoImage = document.getElementById('logoImage');
                    const logoPlaceholder = document.getElementById('logoPlaceholder');
                    
                    logoImage.src = logoPreview.src;
                    logoImage.style.display = 'block';
                    logoPlaceholder.style.display = 'none';
                    logoAtual = logoPreview.src;
                    
                    fecharModal('modalLogo');
                    showAlert('üñºÔ∏è Logo atualizado com sucesso!');
                } else {
                    showAlert('Selecione um arquivo de imagem primeiro!', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar logo:', error);
                showAlert('Erro ao salvar logo', 'error');
            }
        }

        async function removerLogo() {
            if (confirm('Tem certeza que deseja remover o logo?')) {
                try {
                    await db.delete('sistema', 'logo');
                    
                    // Restaurar placeholder
                    const logoImage = document.getElementById('logoImage');
                    const logoPlaceholder = document.getElementById('logoPlaceholder');
                    
                    logoImage.style.display = 'none';
                    logoPlaceholder.style.display = 'block';
                    logoAtual = null;
                    
                    fecharModal('modalLogo');
                    showAlert('üóëÔ∏è Logo removido com sucesso!');
                } catch (error) {
                    console.error('Erro ao remover logo:', error);
                    showAlert('Erro ao remover logo', 'error');
                }
            }
        }

        // Fun√ß√µes de backup
        async function criarBackup() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showAlert('Criando backup...', 'success');
                const backup = await db.backup();
                
                const dataStr = JSON.stringify(backup, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `villa_borghese_backup_${new Date().toISOString().split('T')[0]}.json`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('üíæ Backup criado e baixado com sucesso!');
            } catch (error) {
                console.error('Erro ao criar backup:', error);
                showAlert('Erro ao criar backup', 'error');
            }
        }

        function restaurarBackup() {
            if (!verificarPermissao('admin')) return;
            
            const input = document.getElementById('hiddenBackupInput');
            input.click();
        }

        async function processarBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const text = await file.text();
                const backupData = JSON.parse(text);
                
                if (confirm('Tem certeza que deseja restaurar este backup? Todos os dados atuais ser√£o substitu√≠dos!')) {
                    const sucesso = await db.restore(backupData);
                    
                    if (sucesso) {
                        showAlert('üì• Backup restaurado com sucesso! A p√°gina ser√° recarregada.');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        showAlert('Erro ao restaurar backup', 'error');
                    }
                }
            } catch (error) {
                console.error('Erro ao processar backup:', error);
                showAlert('Arquivo de backup inv√°lido', 'error');
            }
            
            // Limpar input
            event.target.value = '';
        }

        async function sincronizarDados() {
            if (!verificarPermissao('admin')) return;
            
            try {
                showAlert('Sincronizando dados...', 'success');
                
                // Simular sincroniza√ß√£o com servidor
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Recarregar dados
                await carregarRelatorios();
                await carregarDashboard();
                
                showAlert('üîÑ Dados sincronizados com sucesso!');
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                showAlert('Erro ao sincronizar dados', 'error');
            }
        }

        // Event listeners para modais
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Monitoramento de conex√£o
        window.addEventListener('online', () => {
            db.updateConnectionStatus(true);
            showAlert('üü¢ Conex√£o restaurada!');
        });

        window.addEventListener('offline', () => {
            db.updateConnectionStatus(false);
            showAlert('üî¥ Modo offline ativado', 'error');
        });

        // Inicializa√ß√£o do sistema
        document.addEventListener('DOMContentLoaded', function() {
            // Definir datas padr√£o nos campos de relat√≥rio
            const hoje = new Date();
            const umMesAtras = new Date();
            umMesAtras.setMonth(hoje.getMonth() - 1);
            
            if (document.getElementById('dataInicial')) {
                document.getElementById('dataInicial').value = umMesAtras.toISOString().split('T')[0];
            }
            if (document.getElementById('dataFinal')) {
                document.getElementById('dataFinal').value = hoje.toISOString().split('T')[0];
            }
            
            // Aguardar inicializa√ß√£o do banco
            setTimeout(async () => {
                await carregarLogo();
                showAlert('üèõÔ∏è Villa Borghese Emp√≥rio - Sistema carregado! Bem-vindo ao nosso emp√≥rio gourmet.', 'success');
            }, 1000);
        });

        // Service Worker para PWA (se necess√°rio)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registrado com sucesso:', registration);
                    })
                    .catch(registrationError => {
                        console.log('Falha no registro do SW:', registrationError);
                    });
            });
        }

        // Fun√ß√£o para atualizar dados periodicamente (opcional)
        setInterval(async () => {
            if (usuarioLogado && usuarioLogado.tipo === 'admin') {
                try {
                    // Atualizar estat√≠sticas silenciosamente
                    const usuarios = await db.select('usuarios');
                    const pedidos = await db.select('pedidos');
                    
                    // Atualizar apenas n√∫meros principais
                    document.getElementById('totalUsuarios').textContent = usuarios.filter(u => u.status === 'ativo').length;
                    
                    const hoje = new Date().toDateString();
                    const pedidosHoje = pedidos.filter(p => new Date(p.data).toDateString() === hoje);
                    document.getElementById('totalPedidos').textContent = pedidosHoje.length;
                } catch (error) {
                    // Falha silenciosa
                }
            }
        }, 30000); // Atualizar a cada 30 segundos
    </script>
</body>
</html>
                                            <option value="Administra√ß√£o">Administra√ß√£o</option>
                            <option value="Cozinha">Cozinha</option>
                            <option value="Atendimento">Atendimento</option>
                            <option value="Vendas">Vendas</option>
                            <option value="Delivery">Delivery</option>
                            <option value="Estoque">Estoque</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Financeiro">Financeiro</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button class="btn btn-sm btn-success" onclick="exportarRelatorio('excel')">üìä Exportar Excel</button>
                        <button class="btn btn-sm btn-warning" onclick="exportarRelatorio('pdf')">üìã Exportar PDF</button>
                        <button class="btn btn-sm" onclick="sincronizarDados()">üîÑ Sincronizar</button>
                    </div>

                    <div class="loading" id="loadingRelatorios">Carregando relat√≥rios...</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Usu√°rio</th>
                                <th>Email</th>
                                <th>Setor</th>
                                <th>Dias Pedidos</th>
                                <th>Status</th>
                                <th>Valor Total</th>
                            </tr>
                        </thead>
                        <tbody id="relatorioTabela">
                            <!-- Dados carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Configura√ß√µes do Sistema -->
            <div id="configuracoes" class="tab-content">
                <div class="card">
                    <h2 style="color: #ff6b1a; margin-bottom: 25px;">‚öôÔ∏è Configura√ß√µes do Sistema</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome da Empresa:</label>
                            <input type="text" id="nomeEmpresa" value="Villa Borghese Emp√≥rio">
                        </div>
                        <div class="form-group">
                            <label>Email de Contato:</label>
                            <input type="email" id="emailContato" value="contato@villaborghese.com.br">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Telefone:</label>
                            <input type="tel" id="telefoneContato" value="(11) 3456-7890">
                        </div>
                        <div class="form-group">
                            <label>Endere√ßo:</label>
                            <input type="text" id="enderecoEmpresa" value="Rua das Flores, 123 - Vila Madalena - S√£o Paulo/SP">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hor√°rio de Pedidos (At√©):</label>
                            <input type="time" id="horarioLimite" value="10:00">
                        </div>
                        <div class="form-group">
                            <label>Valor Base da Marmita (R$):</label>
                            <input type="number" id="valorMarmita" value="22.00" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Dias de Funcionamento:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="configSegunda" checked>
                                <label for="configSegunda">Segunda-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configTerca" checked>
                                <label for="configTerca">Ter√ßa-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configQuarta" checked>
                                <label for="configQuarta">Quarta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configQuinta" checked>
                                <label for="configQuinta">Quinta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configSexta" checked>
                                <label for="configSexta">Sexta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configSabado">
                                <label for="configSabado">S√°bado</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="configDomingo">
                                <label for="configDomingo">Domingo</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Backup Autom√°tico:</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <button class="btn btn-sm btn-success" onclick="criarBackup()">üíæ Criar Backup</button>
                            <button class="btn btn-sm btn-warning" onclick="restaurarBackup()">üì• Restaurar Backup</button>
                            <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="processarBackup(event)">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="salvarConfiguracoes()">üíæ Salvar Configura√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- Modal Usu√°rio -->
        <div id="modalUsuario" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModal('modalUsuario')">&times;</span>
                <h2 style="color: #ff6b1a; margin-bottom: 25px;">üë§ Gerenciar Usu√°rio</h2>
                <form onsubmit="salvarUsuario(event)">
                    <input type="hidden" id="usuarioId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome Completo:</label>
                            <input type="text" id="usuarioNome" required>
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="usuarioEmail" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Setor:</label>
                            <select id="usuarioSetor" required>
                                <option value="">Selecione o setor</option>
                                <option value="Administra√ß√£o">Administra√ß√£o</option>
                                <option value="Cozinha">Cozinha</option>
                                <option value="Atendimento">Atendimento</option>
                                <option value="Vendas">Vendas</option>
                                <option value="Delivery">Delivery</option>
                                <option value="Estoque">Estoque</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Financeiro">Financeiro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Usu√°rio:</label>
                            <select id="usuarioTipo" required>
                                <option value="usuario">Usu√°rio</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Senha:</label>
                            <input type="password" id="usuarioSenha">
                            <small style="color: #666;">Deixe em branco para manter a senha atual</small>
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="usuarioStatus">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Usu√°rio</button>
                </form>
            </div>
        </div>

        <!-- Modal Card√°pio -->
        <div id="modalCardapio" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModal('modalCardapio')">&times;</span>
                <h2 style="color: #ff6b1a; margin-bottom: 25px;">üçΩÔ∏è Gerenciar Card√°pio</h2>
                <form onsubmit="salvarCardapio(event)">
                    <input type="hidden" id="cardapioId">
                    <div class="form-group">
                        <label>Dia da Semana:</label>
                        <select id="cardapioDia" required>
                            <option value="">Selecione o dia</option>
                            <option value="Segunda">Segunda-feira</option>
                            <option value="Ter√ßa">Ter√ßa-feira</option>
                            <option value="Quarta">Quarta-feira</option>
                            <option value="Quinta">Quinta-feira</option>
                            <option value="Sexta">Sexta-feira</option>
                            <option value="S√°bado">S√°bado</option>
                            <option value="Domingo">Domingo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o do Prato:</label>
                        <textarea id="cardapioDescricao" required placeholder="Ex: Salm√£o grelhado com quinoa, aspargos refogados e salada de r√∫cula"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pre√ßo (R$):</label>
                            <input type="number" id="cardapioPreco" step="0.01" value="22.00" required>
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="cardapioStatus">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Card√°pio</button>
                </form>
            </div>
        </div>

        <!-- Modal Logo -->
        <div id="modalLogo" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModal('modalLogo')">&times;</span>
                <h2 style="color: #ff6b1a; margin-bottom: 25px;">üñºÔ∏è Alterar Logo da Empresa</h2>
                <div style="text-align: center; margin-bottom: 25px;">
                    <div class="logo-circle" style="margin: 0 auto; cursor: default;">
                        <img id="logoPreview" class="logo-image" style="display: none;" alt="Preview do Logo">
                        <span id="logoPreviewPlaceholder" class="logo-placeholder">üèõÔ∏è</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Selecionar Arquivo de Logo:</label>
                    <input type="file" id="logoFile" accept="image/*" onchange="previewLogo(event)">
                    <small style="color: #666;">Formatos aceitos: JPG, PNG, GIF. Tamanho recomendado: 200x200px</small>
                </div>
                <div style="display: flex; gap: 15px;">
                    <button class="btn" onclick="salvarLogo()">üíæ Salvar Logo</button>
                    <button class="btn btn-danger" onclick="removerLogo()">üóëÔ∏è Remover Logo</button>
                </div>
            </div>
        </div>
    </div>

    <div id="alert-container"></div>

    <!-- Input hidden para upload de arquivo de backup -->
    <input type="file" id="hiddenBackupInput" accept=".json" style="display: none;" onchange="processarBackup(event)">

    <script>
        // Sistema de Banco de Dados SQLite Simulado
        class SQLiteDatabase {
            constructor() {
                this.dbName = 'villa_borghese_db';
                this.version = 1;
                this.db = null;
                this.initDatabase();
            }

            async initDatabase() {
                try {
                    // Simular conex√£o SQLite com IndexedDB
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => {
                        console.error('Erro ao abrir banco de dados');
                        this.fallbackToMemory();
                    };

                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        this.popularDadosIniciais();
                        this.updateConnectionStatus(true);
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Criar tabelas
                        if (!db.objectStoreNames.contains('usuarios')) {
                            const usuariosStore = db.createObjectStore('usuarios', { keyPath: 'id', autoIncrement: true });
                            usuariosStore.createIndex('email', 'email', { unique: true });
                        }

                        if (!db.objectStoreNames.contains('cardapio')) {
                            db.createObjectStore('cardapio', { keyPath: 'id', autoIncrement: true });
                        }

                        if (!db.objectStoreNames.contains('pedidos')) {
                            db.createObjectStore('pedidos', { keyPath: 'id', autoIncrement: true });
                        }

                        if (!db.objectStoreNames.contains('configuracoes')) {
                            db.createObjectStore('configuracoes', { keyPath: 'chave' });
                        }

                        if (!db.objectStoreNames.contains('sistema')) {
                            db.createObjectStore('sistema', { keyPath: 'chave' });
                        }
                    };
                } catch (error) {
                    console.error('Erro no IndexedDB:', error);
                    this.fallbackToMemory();
                }
            }

            fallbackToMemory() {
                // Fallback para dados em mem√≥ria se IndexedDB falhar
                this.memoryData = {
                    usuarios: [
                        {
                            id: 1,
                            nome: 'Giuseppe Borghese',
                            email: 'admin@villaborghese.com.br',
                            senha: 'villa2024',
                            setor: 'Administra√ß√£o',
                            tipo: 'admin',
                            status: 'ativo',
                            dataCadastro: new Date().toISOString()
                        },
                        {
                            id: 2,
                            nome: 'Maria Antonietta',
                            email: 'maria@villaborghese.com.br',
                            senha: 'emporio123',
                            setor: 'Cozinha',
                            tipo: 'usuario',
                            status: 'ativo',
                            dataCadastro: new Date().toISOString()
                        }
                    ],
                    cardapio: [
                        { id: 1, dia: 'Segunda', descricao: 'Salm√£o grelhado com quinoa, aspargos refogados e salada de r√∫cula com tomate cereja', preco: 22.00, status: 'ativo' },
                        { id: 2, dia: 'Ter√ßa', descricao: 'Fil√© mignon ao molho madeira, risoto de cogumelos e legumes no vapor', preco: 28.00, status: 'ativo' },
                        { id: 3, dia: 'Quarta', descricao: 'Peito de frango recheado com queijo brie, batata r√∫stica e salada mediterr√¢nea', preco: 20.00, status: 'ativo' },
                        { id: 4, dia: 'Quinta', descricao: 'Bacalhau desfiado com gr√£o-de-bico, batata doce assada e acelga refogada', preco: 24.00, status: 'ativo' },
                        { id: 5, dia: 'Sexta', descricao: 'Cordeiro refogado com ervas finas, polenta cremosa e ratatouille proven√ßal', preco: 32.00, status: 'ativo' }
                    ],
                    pedidos: [],
                    configuracoes: {
                        nomeEmpresa: 'Villa Borghese Emp√≥rio',
                        emailContato: 'contato@villaborghese.com.br',
                        telefone: '(11) 3456-7890',
                        endereco: 'Rua das Flores, 123 - Vila Madalena - S√£o Paulo/SP'
                    },
                    nextId: { usuarios: 3, cardapio: 6, pedidos: 1 }
                };
                this.updateConnectionStatus(false);
            }

            updateConnectionStatus(online) {
                const status = document.getElementById('connectionStatus');
                if (online) {
                    status.className = 'connection-status connection-online';
                    status.textContent = 'üü¢ SQLite Online';
                } else {
                    status.className = 'connection-status connection-offline';
                    status.textContent = 'üî¥ Modo Offline';
                }
            }

            async popularDadosIniciais() {
                try {
                    const usuariosCount = await this.count('usuarios');
                    if (usuariosCount === 0) {
                        await this.insert('usuarios', {
                            nome: 'Giuseppe Borghese',
                            email: 'admin@villaborghese.com.br',
                            senha: 'villa2024',
                            setor: 'Administra√ß√£o',
                            tipo: 'admin',
                            status: 'ativo',
                            dataCadastro: new Date().toISOString()
                        });

                        await this.insert('usuarios', {
                            nome: 'Maria Antonietta',
                            email: 'maria@villaborghese.com.br',
                            senha: 'emporio123',
                            setor: 'Cozinha',
                            tipo: 'usuario',
                            status: 'ativo',
                            dataCadastro: new Date().toISOString()
                        });

                        // Card√°pio inicial
                        const cardapioInicial = [
                            { dia: 'Segunda', descricao: 'Salm√£o grelhado com quinoa, aspargos refogados e salada de r√∫cula com tomate cereja', preco: 22.00, status: 'ativo' },
                            { dia: 'Ter√ßa', descricao: 'Fil√© mignon ao molho madeira, risoto de cogumelos e legumes no vapor', preco: 28.00, status: 'ativo' },
                            { dia: 'Quarta', descricao: 'Peito de frango recheado com queijo brie, batata r√∫stica e salada mediterr√¢nea', preco: 20.00, status: 'ativo' },
                            { dia: 'Quinta', descricao: 'Bacalhau desfiado com gr√£o-de-bico, batata doce assada e acelga refogada', preco: 24.00, status: 'ativo' },
                            { dia: 'Sexta', descricao: 'Cordeiro refogado com ervas finas, polenta cremosa e ratatouille proven√ßal', preco: 32.00, status: 'ativo' }
                        ];

                        for (const prato of cardapioInicial) {
                            await this.insert('cardapio', prato);
                        }

                        // Configura√ß√µes iniciais
                        await this.insert('configuracoes', {
                            chave: 'empresa',
                            valor: {
                                nomeEmpresa: 'Villa Borghese Emp√≥rio',
                                emailContato: 'contato@villaborghese.com.br',
                                telefone: '(11) 3456-7890',
                                endereco: 'Rua das Flores, 123 - Vila Madalena - S√£o Paulo/SP',
                                horarioLimite: '10:00',
                                valorMarmita: 22.00,
                                diasFuncionamento: ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta']
                            }
                        });
                    }
                } catch (error) {
                    console.error('Erro ao popular dados iniciais:', error);
                }
            }

            async query(store, operation, data = null) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        // Usar dados em mem√≥ria como fallback
                        this.handleMemoryOperation(store, operation, data, resolve, reject);
                        return;
                    }

                    const transaction = this.db.transaction([store], operation === 'get' || operation === 'getAll' || operation === 'count' ? 'readonly' : 'readwrite');
                    const objectStore = transaction.objectStore(store);

                    let request;
                    switch (operation) {
                        case 'add':
                            request = objectStore.add(data);
                            break;
                        case 'put':
                            request = objectStore.put(data);
                            break;
                        case 'delete':
                            request = objectStore.delete(data);
                            break;
                        case 'get':
                            request = objectStore.get(data);
                            break;
                        case 'getAll':
                            request = objectStore.getAll();
                            break;
                        case 'count':
                            request = objectStore.count();
                            break;
                        default:
                            reject(new Error('Opera√ß√£o n√£o suportada'));
                            return;
                    }

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            handleMemoryOperation(store, operation, data, resolve, reject) {
                try {
                    if (!this.memoryData[store]) {
                        this.memoryData[store] = [];
                    }

                    switch (operation) {
                        case 'add':
                            data.id = this.memoryData.nextId[store]++;
                            this.memoryData[store].push(data);
                            resolve(data);
                            break;
                        case 'put':
                            const index = this.memoryData[store].findIndex(item => item.id === data.id);
                            if (index !== -1) {
                                this.memoryData[store][index] = data;
                            } else {
                                this.memoryData[store].push(data);
                            }
                            resolve(data);
                            break;
                        case 'delete':
                            this.memoryData[store] = this.memoryData[store].filter(item => item.id !== data);
                            resolve();
                            break;
                        case 'get':
                            const item = this.memoryData[store].find(item => item.id === data);
                            resolve(item);
                            break;
                        case 'getAll':
                            resolve([...this.memoryData[store]]);
                            break;
                        case 'count':
                            resolve(this.memoryData[store].length);
                            break;
                        default:
                            reject(new Error('Opera√ß√£o n√£o suportada'));
                    }
                } catch (error) {
                    reject(error);
                }
            }

            async insert(table, data) {
                return await this.query(table, 'add', data);
            }

            async update(table, data) {
                return await this.query(table, 'put', data);
            }

            async delete(table, id) {
                return await this.query(table, 'delete', id);
            }

            async select(table, id = null) {
                if (id) {
                    return await this.query(table, 'get', id);
                } else {
                    return await this.query(table, 'getAll');
                }
            }

            async count(table) {
                return await this.query(table, 'count');
            }

            async backup() {
                const backup = {
                    timestamp: new Date().toISOString(),
                    version: this.version,
                    data: {}
                };

                try {
                    backup.data.usuarios = await this.select('usuarios');
                    backup.data.cardapio = await this.select('cardapio');
                    backup.data.pedidos = await this.select('pedidos');
                    backup.data.configuracoes = await this.select('configuracoes');
                    backup.data.sistema = await this.select('sistema');
                } catch (error) {
                    console.error('Erro ao criar backup:', error);
                }

                return backup;
            }

            async restore(backupData) {
                try {
                    // Limpar dados existentes e restaurar backup
                    if (backupData.data.usuarios) {
                        for (const usuario of backupData.data.usuarios) {
                            await this.update('usuarios', usuario);
                        }
                    }
                    
                    if (backupData.data.cardapio) {
                        for (const prato of backupData.data.cardapio) {
                            await this.update('cardapio', prato);
                        }
                    }

                    if (backupData.data.pedidos) {
                        for (const pedido of backupData.data.pedidos) {
                            await this.update('pedidos', pedido);
                        }
                    }

                    return true;
                } catch (error) {
                    console.error('Erro ao restaurar backup:', error);
                    return false;
                }
            }
        }

        // Inst√¢ncia do banco de dados
        const db = new SQLiteDatabase();
        let usuarioLogado = null;
        let logoAtual = null;

        // Fun√ß√µes de utilidade
        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '1000';
            
            document.getElementById('alert-container').appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 4000);
        }

        function showLoading(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (element) {
                if (show) {
                    element.classList.add('show');
                } else {
                    element.classList.remove('show');
                }
            }
        }

        function verificarPermissao(permissaoNecessaria = 'admin') {
            if (!usuarioLogado) return false;
            if (permissaoNecessaria === 'admin' && usuarioLogado.tipo !== 'admin') {
                return false;
            }
            return true;
        }

        function mostrarPermissaoNegada(elemento) {
            elemento.innerHTML = `
                <div class="permission-denied">
                    <h2>üö´ Acesso Negado</h2>
                    <p>Voc√™ n√£o tem permiss√£o para acessar esta √°rea.</p>
                    <p>Entre em contato com o administrador do sistema.</p>
                </div>
            `;
        }

        // Fun√ß√µes de autentica√ß√£o
        async function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const senha = document.getElementById('loginPassword').value;
            
            try {
                const usuarios = await db.select('usuarios');
                const usuario = usuarios.find(u => u.email === email && u.senha === senha && u.status === 'ativo');
                
                if (usuario) {
                    usuarioLogado = usuario;
                    await showMainSystem();
                    showAlert('üèõÔ∏è Login realizado com sucesso! Bem-vindo ao Villa Borghese.');
                } else {
                    showAlert('Email, senha incorretos ou usu√°rio inativo!', 'error');
                }
            } catch (error) {
                console.error('Erro no login:', error);
                showAlert('Erro ao fazer login. Tente novamente.', 'error');
            }
        }

        function logout() {
            usuarioLogado = null;
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('main-system').style.display = 'none';
            showAlert('üèõÔ∏è Logout realizado com sucesso! Arrivederci!');
        }

        async function showMainSystem() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-system').style.display = 'block';
            document.getElementById('userName').textContent = usuarioLogado.nome;
            document.getElementById('userSetor').textContent = usuarioLogado.setor;
            document.getElementById('userTipo').textContent = usuarioLogado.tipo === 'admin' ? 'Administrador' : 'Usu√°rio';
            
            // Mostrar/ocultar abas baseado na permiss√£o
            if (usuarioLogado.tipo === 'admin') {
                document.getElementById('dashboardTab').style.display = 'block';
                document.getElementById('usuariosTab').style.display = 'block';
                document.getElementById('cardapioTab').style.display = 'block';
                document.getElementById('relatoriosTab').style.display = 'block';
                document.getElementById('configTab').style.display = 'block';
            }
            
            // Carregar logo se existir
            await carregarLogo();
            
            // Carregar dados iniciais
            await carregarMenu();
            await carregar<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Villa Borghese Emp√≥rio - Sistema de Marmitas</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff6b1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff8c42 0%, #ff6b1a 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-circle {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .logo-placeholder {
            font-size: 2.5rem;
        }

        .logo-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            border-radius: 50%;
        }

        .logo-circle:hover .logo-upload-overlay {
            display: flex;
        }

        .company-name {
            text-align: left;
        }

        .company-name h1 {
            font-size: 2.8rem;
            margin: 0;
            font-family: 'Georgia', serif;
        }

        .company-name p {
            font-size: 1.5rem;
            margin: 0;
            font-style: italic;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 25px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: white;
            color: #ff6b1a;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b1a;
            box-shadow: 0 0 0 3px rgba(255,107,26,0.1);
        }

        .btn {
            background: linear-gradient(135deg, #ff6b1a, #ff8c42);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255,107,26,0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #ffca2c);
            color: #333;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #fff3e6;
            border-color: #ff6b1a;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #ff6b1a;
        }

        .menu-panel {
            background: linear-gradient(135deg, #fff3e6, #ffe5d1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }

        .menu-panel h3 {
            color: #ff6b1a;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .menu-day {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s ease;
        }

        .menu-day:hover {
            transform: translateY(-5px);
        }

        .menu-day h4 {
            color: #ff6b1a;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .menu-day p {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .menu-price {
            color: #ff6b1a;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 15px 0;
        }

        .menu-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
        }

        .search-bar {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: linear-gradient(135deg, #ff6b1a, #ff8c42);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #fff3e6;
        }

        .user-info {
            background: linear-gradient(135deg, #fff3e6, #ffe5d1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-details h3 {
            margin-bottom: 5px;
            color: #ff6b1a;
        }

        .user-details p {
            color: #666;
        }

        .logout-btn {
            background: #dc3545;
            width: auto;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff3e6, #ffe5d1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: #ff6b1a;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #ff6b1a;
        }

        .permission-denied {
            text-align: center;
            padding: 50px;
            color: #dc3545;
        }

        .permission-denied h2 {
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        .status-ativo {
            background: #d4edda;
            color: #155724;
        }

        .status-inativo {
            background: #f8d7da;
            color: #721c24;
        }

        .status-admin {
            background: #d1ecf1;
            color: #0c5460;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading.show {
            display: block;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1001;
        }

        .connection-online {
            background: #d4edda;
            color: #155724;
        }

        .connection-offline {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .search-bar {
                grid-template-columns: 1fr;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }

            .logo-container {
                flex-direction: column;
                gap: 10px;
            }

            .company-name {
                text-align: center;
            }

            .company-name h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status connection-online">üü¢ Online</div>
    
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo-circle" onclick="abrirModalLogo()">
                    <img id="logoImage" class="logo-image" style="display: none;" alt="Villa Borghese Logo">
                    <span id="logoPlaceholder" class="logo-placeholder">üèõÔ∏è</span>
                    <div class="logo-upload-overlay">
                        <span>Alterar Logo</span>
                    </div>
                </div>
                <div class="company-name">
                    <h1>Villa Borghese</h1>
                    <p>Emp√≥rio</p>
                </div>
            </div>
            <p style="font-size: 1.1rem; opacity: 0.9;">Sistema de Gest√£o de Marmitas Gourmet</p>
        </div>

        <!-- √Årea de Login -->
        <div id="auth-section">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 30px; color: #ff6b1a;">üîê Acesso ao Sistema</h2>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn">Entrar no Sistema</button>
                </form>
                
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #fff3e6; border-radius: 10px;">
                    <p><strong>üèõÔ∏è Villa Borghese Emp√≥rio - Acesso Demo:</strong></p>
                    <p>üë®‚Äçüíº Admin: admin@villaborghese.com.br / senha: villa2024</p>
                    <p>üë©‚Äçüç≥ Funcion√°ria: maria@villaborghese.com.br / senha: emporio123</p>
                    <hr style="margin: 15px 0; border: 1px solid #ff6b1a; opacity: 0.3;">
                    <p style="font-size: 0.9rem; color: #666;">
                        üìç Rua das Flores, 123 - Vila Madalena - S√£o Paulo/SP<br>
                        üìû (11) 3456-7890 | üïê 08:00 √†s 18:00
                    </p>
                </div>
            </div>
        </div>

        <!-- Sistema Principal -->
        <div id="main-system" style="display: none;">
            <div class="user-info">
                <div class="user-details">
                    <h3>Bem-vindo(a), <span id="userName"></span>!</h3>
                    <p>Setor: <span id="userSetor"></span> | Tipo: <span id="userTipo"></span></p>
                </div>
                <button class="btn logout-btn" onclick="logout()">Sair</button>
            </div>

            <!-- Abas de navega√ß√£o -->
            <div class="nav-tabs" id="mainTabs">
                <button class="nav-tab active" onclick="showMainTab('pedidos')">üìã Meus Pedidos</button>
                <button class="nav-tab" onclick="showMainTab('dashboard')" id="dashboardTab" style="display:none;">üìä Dashboard</button>
                <button class="nav-tab" onclick="showMainTab('usuarios')" id="usuariosTab" style="display:none;">üë• Usu√°rios</button>
                <button class="nav-tab" onclick="showMainTab('cardapio')" id="cardapioTab" style="display:none;">üçΩÔ∏è Card√°pio</button>
                <button class="nav-tab" onclick="showMainTab('relatorios')" id="relatoriosTab" style="display:none;">üìà Relat√≥rios</button>
                <button class="nav-tab" onclick="showMainTab('configuracoes')" id="configTab" style="display:none;">‚öôÔ∏è Configura√ß√µes</button>
            </div>

            <!-- Pedidos do Usu√°rio -->
            <div id="pedidos" class="tab-content active">
                <div class="card">
                    <h2 style="color: #ff6b1a; margin-bottom: 25px;">üçΩÔ∏è Pedido de Marmita Gourmet</h2>
                    
                    <div style="background: linear-gradient(135deg, #fff3e6, #ffe5d1); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                        <h3 style="color: #ff6b1a; margin-bottom: 15px; text-align: center;">Villa Borghese - Marmitas Artesanais</h3>
                        <p style="text-align: center; color: #666; margin-bottom: 15px;">
                            Ingredientes selecionados ‚Ä¢ Preparo artesanal ‚Ä¢ Sabor aut√™ntico italiano
                        </p>
                        <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; font-size: 0.9rem; color: #666;">
                            <span>üìû (11) 3456-7890</span>
                            <span>üìç Vila Madalena</span>
                            <span>üïê Pedidos at√© 10h</span>
                        </div>
                    </div>
                    
                    <form onsubmit="fazerPedido(event)">
                        <div class="form-group">
                            <label style="font-size: 1.2rem; color: #ff6b1a;">üç± MARMITA GOURMET VILLA BORGHESE</label>
                            <p style="color: #666; margin-bottom: 15px;">Selecione os dias para receber suas marmitas artesanais:</p>
                        </div>

                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="segunda" value="Segunda">
                                <label for="segunda">Segunda-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="terca" value="Ter√ßa">
                                <label for="terca">Ter√ßa-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="quarta" value="Quarta">
                                <label for="quarta">Quarta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="quinta" value="Quinta">
                                <label for="quinta">Quinta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sexta" value="Sexta">
                                <label for="sexta">Sexta-feira</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sabado" value="S√°bado">
                                <label for="sabado">S√°bado</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="domingo" value="Domingo">
                                <label for="domingo">Domingo</label>
                            </div>
                        </div>

                        <button type="submit" class="btn">üõí Confirmar Pedido</button>
                    </form>

                    <!-- Menu Semanal -->
                    <div class="menu-panel">
                        <h3>üèõÔ∏è Menu Semanal Villa Borghese</h3>
                        <p style="text-align: center; color: #666; margin-bottom: 20px; font-style: italic;">
                            "Tradi√ß√£o italiana em cada prato"
                        </p>
                        <div class="menu-grid" id="menuGrid">
                            <!-- Menu ser√° carregado dinamicamente -->
                        </div>
                        <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.7); border-radius: 10px;">
                            <p style="color: #ff6b1a; font-weight: bold; margin: 0;">
                                ‚≠ê Todos os pratos incluem: Entrada + Prato Principal + Sobremesa + √Ågua
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Hist√≥rico de Pedidos do Usu√°rio -->
                <div class="card">
                    <h2 style="color: #ff6b1a; margin-bottom: 25px;">üìÖ Meu Hist√≥rico de Pedidos</h2>
                    <div class="loading" id="loadingPedidos">Carregando pedidos...</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Dias Selecionados</th>
                                <th>Status</th>
                                <th>Valor Total</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="historicoPedidos">
                            <!-- Dados carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dashboard Admin -->
            <div id="dashboard" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalUsuarios">0</h3>
                        <p>Usu√°rios Ativos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalPedidos">0</h3>
                        <p>Pedidos Hoje</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalMarmitas">0</h3>
                        <p>Marmitas Esta Semana</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="receitaSemana">R$ 0</h3>
                        <p>Receita Semanal</p>
                    </div>
                </div>

                <div class="card">
                    <h2 style="color: #ff6b1a; margin-bottom: 25px;">üìä Estat√≠sticas por Setor</h2>
                    <div class="loading" id="loadingDashboard">Carregando estat√≠sticas...</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Setor</th>
                                <th>Pedidos Hoje</th>
                                <th>Total Semana</th>
                                <th>Usu√°rios Ativos</th>
                                <th>Receita Semana</th>
                            </tr>
                        </thead>
                        <tbody id="estatisticasSetor">
                            <!-- Dados carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gerenciamento de Usu√°rios -->
            <div id="usuarios" class="tab-content">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="color: #ff6b1a;">üë• Gerenciamento de Usu√°rios</h2>
                        <button class="btn btn-sm" onclick="abrirModalUsuario()">+ Novo Usu√°rio</button>
                    </div>
                    
                    <div class="loading" id="loadingUsuarios">Carregando usu√°rios...</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Setor</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>Cadastrado</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="listaUsuarios">
                            <!-- Dados carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gerenciamento de Card√°pio -->
            <div id="cardapio" class="tab-content">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="color: #ff6b1a;">üçΩÔ∏è Gerenciamento de Card√°pio</h2>
                        <button class="btn btn-sm" onclick="abrirModalCardapio()">+ Novo Prato</button>
                    </div>
                    
                    <div class="loading" id="loadingCardapio">Carregando card√°pio...</div>
                    <div class="menu-grid" id="cardapioAdmin">
                        <!-- Card√°pio carregado dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios Administrativos -->
            <div id="relatorios" class="tab-content">
                <div class="card">
                    <h2 style="color: #ff6b1a; margin-bottom: 25px;">üìà Relat√≥rios Administrativos</h2>
                    
                    <div class="search-bar">
                        <div class="form-group">
                            <label>Data Inicial:</label>
                            <input type="date" id="dataInicial">
                        </div>
                        <div class="form-group">
                            <label>Data Final:</label>
                            <input type="date" id="dataFinal">
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="gerarRelatorio()" style="margin-top: 32px;">üîç Gerar Relat√≥rio</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Filtrar por Setor:</label>
                        <select id="filtroSetor">
                            <option value="">Todos os Setores</option>
                            <option value="Administra√ß√£o